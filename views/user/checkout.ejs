<!DOCTYPE html>
<html lang="en">


<!-- molla/checkout  22 Nov 2019 09:55:06 GMT -->

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title>Molla - Bootstrap eCommerce Template</title>
	<meta name="keywords" content="HTML5 Template">
	<meta name="description" content="Molla - Bootstrap eCommerce Template">
	<meta name="author" content="p-themes">
	<!-- Favicon -->
	<link rel="apple-touch-icon" sizes="180x180" href="public/assets/images/icons/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="public/assets/images/icons/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="public/assets/images/icons/favicon-16x16.png">
	<link rel="manifest" href="public/assets/images/icons/site">
	<link rel="mask-icon" href="public/assets/images/icons/safari-pinned-tab.svg" color="#666666">
	<link rel="shortcut icon" href="public/assets/images/icons/favicon.ico">
	<meta name="apple-mobile-web-app-title" content="Molla">
	<meta name="application-name" content="Molla">
	<meta name="msapplication-TileColor" content="#cc9966">
	<meta name="msapplication-config" content="public/assets/images/icons/browserconfig.xml">
	<meta name="theme-color" content="#ffffff">
	<!-- Plugins CSS File -->
	<link rel="stylesheet" href="public/assets/css/bootstrap.min.css">
	<!-- Main CSS File -->
	<link rel="stylesheet" href="public/assets/css/style.css">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">

	<!-- Include jQuery from a CDN -->
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>



</head>

<body>
	<div id="preloader"></div>

	<div class="page-wrapper">
		<header class="header">
			<div class="header-top">
				<div class="container">
					<div class="header-left">
						<div class="header-dropdown">
							<a href="#">Usd</a>
							<div class="header-menu">
								<ul>
									<li><a href="#">Eur</a></li>
									<li><a href="#">Usd</a></li>
								</ul>
							</div><!-- End .header-menu -->
						</div><!-- End .header-dropdown -->

						<div class="header-dropdown">
							<a href="#">Eng</a>
							<div class="header-menu">
								<ul>
									<li><a href="#">English</a></li>
									<li><a href="#">French</a></li>
									<li><a href="#">Spanish</a></li>
								</ul>
							</div><!-- End .header-menu -->
						</div><!-- End .header-dropdown -->
					</div><!-- End .header-left -->

					<div class="header-right">
						<ul class="top-menu">
							<li>
								<a href="#">Links</a>
								<ul>
									<li><a href="tel:#"><i class="icon-phone"></i>Call: +0123 456 789</a></li>
									<li><a href="wishlist"><i class="icon-heart-o"></i>Wishlist <span>(3)</span></a>
									</li>
									<li><a href="about">About Us</a></li>
									<li><a href="contact">Contact Us</a></li>
									<li><a href="#signin-modal" data-toggle="modal"><i class="icon-user"></i>Login</a>
									</li>
								</ul>
							</li>
						</ul><!-- End .top-menu -->
					</div><!-- End .header-right -->
				</div>
			</div><!-- End .header-top -->

			<div class="header-middle sticky-header">
				<div class="container">
					<div class="header-left">
						<button class="mobile-menu-toggler">
							<span class="sr-only">Toggle mobile menu</span>
							<i class="icon-bars"></i>
						</button>

						<a href="index" class="logo">
							<img src="/public/assets/imgs/theme/logo.png" alt="Molla Logo" width="105" height="25">
						</a>

						<nav class="main-nav">
							<ul class="menu sf-arrows">
								<li class="megamenu-container active">
									<a href="/">Home</a>
								</li>

								<li>
									<a href="shop">Shop</a>

								</li>

								<li>
									<a href="#" class="sf-with-ul">Pages</a>

									<ul>
										<li>
											<a href="about">About</a>
										</li>
										<li>
											<a href="contact">Contact</a>
										</li>
										<li><a href="login">Login</a></li>
										<li><a href="faq">FAQs</a></li>
									</ul>
								</li>

							</ul><!-- End .menu -->
						</nav><!-- End .main-nav -->
					</div><!-- End .header-left -->

					
				</div>
			</div><!-- End .header-middle -->
		</header><!-- End .header -->

		<main class="main">
			<nav aria-label="breadcrumb" class="breadcrumb-nav">
				<div class="container">
					<ol class="breadcrumb">
						<li class="breadcrumb-item"><a href="/">Home</a></li>
						<li class="breadcrumb-item"><a href="/cart">Cart</a></li>
						<li class="breadcrumb-item active" aria-current="/checkout">Checkout</li>
					</ol>
				</div>
			</nav><!-- End .breadcrumb-nav -->

			<div class="page-content ">
				<div class="checkout">
					<div class="container  ">
						<div class="checkout-discount" id="reloadArea2">
							<% console.log(cartData.couponDiscount, "is tsi ") %>
							<% if (cartData.couponDiscount == 0) { %>
								<div class="input-group">
									<input type="text" class="form-control" id="couponinput" name="coupon" placeholder="Enter your coupon code">
									<div class="input-group-append">
										<button class="btn btn-outline-warning btn-sm" type="button" id="applyCouponButton" onclick="applyCoupon()">Apply Coupon</button>
									</div>
								</div>
							<% } else { %>
								<div class="input-group">
									<input type="text" class="form-control" id="couponinput" name="coupon" disabled value="<%=cartData.couponDiscount.couponCode%>">
									<div class="input-group-append">
										<button class="btn btn-outline-warning btn-sm" type="button" id="applyCouponButton" onclick="removecoupon()">Remove</button>
									</div>
								</div>
							<% } %>
						</div>
			
						<span class="btn-text">
							<a class="btn btn-outline-warning" href="#" data-toggle="modal" data-target="#addAddressModal">Add Address</a>
						</span>
			
						<form id="orderForm">
							<div class="row" style="justify-content: space-around;" id="addrassArea"> 
								<% if (addresses && addresses.address && addresses.address.length > 0) { %>
									<div id="addressAccordion">
										<% addresses?.address?.forEach(function (address, index) { %>
											<div class="card">
												<div class="card-header" id="addressHeading<%= index %>">
													<h2 class="mb-0">
														<button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse<%= index %>" aria-expanded="<%= index === 0 ? 'true' : 'false' %>" aria-controls="collapse<%= index %>">
															Address <%= index + 1 %>
														</button>
													</h2>
												</div>
												<div id="collapse<%= index %>" class="collapse <%= index === 0 ? 'show' : '' %>" aria-labelledby="addressHeading<%= index %>" data-parent="#addressAccordion">
													<div class="card-body">
														<input type="radio" name="address" value="<%= index %>" <%= index === 0 ? 'checked' : '' %> >
														<h3 class="card-title">Address <%= index + 1 %></h3>
														<p>
															Name: <%= address.fullName %><br>
															Country: <%= address.country %><br>
															House Name: <%= address.housename %><br>
															State: <%= address.state %><br>
															City: <%= address.city %><br>
															Pincode: <%= address.pincode %><br>
															Phone: <%= address.phone %><br>
															Email: <%= address.email %><br>
															<a href="#" data-toggle="modal" data-target="#addAddressModals" onclick="showEditAddressModal('<%= address.fullName %>','<%= address.country %>', '<%= address.housename %>', '<%= address.state %>', '<%= address.city %>', '<%= address.pincode %>', '<%= address.phone %>', '<%= address.email %>','<%= address._id %>')">Edit <i class="icon-edit"></i></a>
														</p>
													</div>
												</div>
											</div>
										<% }); %>
									</div>
									
										<%}else{%>
											<div class="col-lg-9 billing-details">
												<h2 class="checkout-title">Billing Details</h2>
					
												<div class="form-group">		
													<label for="fullName">Full Name *</label>
													<input type="text" class="form-control" id="fullNames" name="fullName">
												</div>
					
												<div class="form-group">
													<label for="country">Country *</label>
													<input type="text" class="form-control" id="countrys" name="country">
												</div>
					
												<div class="form-group">
													<label for="streetAddress">House name *</label>
													<input type="text" class="form-control" id="streetAddress" name="housename">
												</div>
		
												<div class="row">
													<div class="col-sm-6">
														<div class="form-group">
															<label for="stateCounty">State *</label>
															<input type="text" class="form-control" id="stateCounty" name="state">
														</div>
													</div>
											
													<div class="col-sm-6">
														<div class="form-group">
															<label for="townCity"> City *</label>
															<input type="text" class="form-control" id="townCity" name="city">
														</div>
													</div>
												</div>
											
												<div class="row">
													<div class="col-sm-6">
														<div class="form-group">
															<label for="postcode">Pincode *</label>
															<input type="text" class="form-control" id="postcode" name="pincode">
														</div>
													</div>
											
													<div class="col-sm-6">
														<div class="form-group">
															<label for="phone">Phone *</label>
															<input type="tel" class="form-control" id="phones" name="phone">
														</div>
													</div>
												</div>
												<div class="form-group">
													<label for="email">Email *</label>
													<input type="email" class="form-control" id="emails" name="email">
												</div>
											</div>
										<% } %>



								<aside class="col-lg-3 ">
									<div class="summary">
										<h3 class="summary-title">Your Order</h3>
										<table class="table table-summary"  id="reloadArea">
											<thead>
												<tr>
													<th>Product</th>
													<th>Total</th>
												</tr>
											</thead>
											<% cartData.product.forEach(product=> { %>

											<tbody>
												<tr>
													<td><%= product.productId.name%>(Set of <%= product.quantity %>)</td>
													<td>₹<%= product.productId.price%></td>
												</tr>
												<% }); %>

												<tr class="summary-subtotal">
													<td>Subtotal:</td>
													<td id="subtotal">₹<%= subtotal %></td>
												</tr>
												<tr>
													<td>Shipping:</td>
													<td>Free shipping</td>
												</tr>
												<% if (cartData.couponDiscount!=0 ) { %>
													<tr>
														<td class="text-danger">Coupon Discount:</td>
														<td id="disamount" class="text-danger">-<%= disamo %></td>
													</tr>
													<% } %>
												<tr class="summary-total">
													<td>Total:</td>
													<td id="totalamount">₹<%= discount %></td>
												</tr>
											</tbody>
										</table>

										<div class="accordion-summary" id="accordion-payment">
											<div class="card">
												<div class="card-body">
													<%if(cartData.user.wallet>=discount){%>
													<div class="d-flex align-items-center">
														<div class="mr-2">
															<input required type="radio"  id="walletRadio" name="payment" value="wallet" />
														</div>
														<label class="d-block text-dark" for="walletRadio">Wallet</label>
													</div>
													<%}else{%>
														<div class="d-flex align-items-center">
															<div class="mr-2">
																<input required type="radio" disabled  id="walletRadio" name="payment" value="wallet" />
															</div>
															<label class="d-block text-dark" for="walletRadio">Wallet <span class="text-danger text-sm">(Due to insufficient balance in wallet)</span></label>
														</div>
														<%}%>
												</div>
											</div>
										
											
										
											<div class="card">
												<div class="card-body">
													<div class="d-flex align-items-center">
														<div class="mr-2">
															<input required type="radio" id="onlinePaymentRadio" name="payment" value="onlinePayment"  />
														</div>
														<label class="d-block text-dark" for="onlinePaymentRadio">Online Payment</label>
													</div>
												</div>
											</div>


											<div class="card">
												<div class="card-body">
													<div class="d-flex align-items-center">
														<div class="mr-2">
															<input required type="radio" id="codRadio" name="payment" value="COD" checked />
														</div>
														<label class="d-block text-dark" for="codRadio">Cash On Delivery</label>
													</div>
												</div>
											</div>
										</div>

										<button type="button" onclick="validateFormAddress(event)" id="placeOrderBtn" class="btn btn-outline-warning">PROCEED TOCHECKOUT</a></button>
									</div>
								</aside>
							</div>

						</form>
					</div>
				</div>
			</div>
	    </main>



					

		<script>
			async function validateFormAddress(event) {
				event.preventDefault();

			 var fullName = $('#fullNames').val().trim();
			 var country = $('#countrys').val().trim();
			 var housename = $('#housenames').val().trim();
			 var state = $('#states').val().trim();
			 var city = $('#citys').val().trim();
			 var pincode = $('#pincodes').val().trim();
			 var phone = $('#phones').val().trim();
			 var email = $('#emails').val().trim();
			 var form = $('orderForm');
		 
			 if (fullName === '') {
				 displayError('#fullNames', 'Please enter your full name.');
			 }else if (country === '') {
				 displayError('#countrys', 'Please enter the country.');
			 }else if (housename === '') {
				 displayError('#housenames', 'Please enter the house name.');
			 }else if (state === '') {
				 displayError('#states', 'Please enter the state.');
			 }else if (city === '') {
				 displayError('#citys', 'Please enter the city.');
			 }else if (pincode === '') {
				 displayError('#pincodes', 'Please enter the pincode.');
			 }else if (pincode.length !== 6 || !/^\d+$/.test(pincode)) {
				 displayError('#pincode', 'Please enter a valid 6-digit pincode with only digits.');
			 }else if (phone === '') {
			     displayError('#phones', 'Please enter the phone number.');
		     }else if (phone.length !== 10 || !/^\d+$/.test(phone)) {
			     displayError('#phone', 'Please enter a valid 10-digit phone number with only digits.');
		     }else if (email === '') {
				 displayError('#emails', 'Please enter the email.');
			 }else if (!/\S+@\S+\.\S+/.test(email)) {
				 displayError('#email', 'Please enter a valid email address.');
			 }else{
				form.submit();
			 }
		 }
		 function displayError(elementId, message) {
				 clearError(elementId);
				 $(elementId).after('<div class="error-message text-danger">' + message + '</div>');
			 }
		 
			 function clearError(elementId) {
				 $(elementId).next('.error-message').remove();
			 }
		 
		 
		 </script> 



	<footer class="footer">
		<div class="footer-middle">
			<div class="container">
				<div class="row">
					<div class="col-sm-6 col-lg-3">
						<div class="widget widget-about">
							<img src=" /public/assets/imgs/theme/logo.png" class="footer-logo" alt="Footer Logo" width="105"
								height="25">
							<p>Praesent dapibus, neque id cursus ucibus, tortor neque egestas augue, eu vulputate magna
								eros eu erat. </p>

							<div class="social-icons">
								<a href="#" class="social-icon" target="_blank" title="Facebook"><i
										class="icon-facebook-f"></i></a>
								<a href="#" class="social-icon" target="_blank" title="Twitter"><i
										class="icon-twitter"></i></a>
								<a href="#" class="social-icon" target="_blank" title="Instagram"><i
										class="icon-instagram"></i></a>
								<a href="#" class="social-icon" target="_blank" title="Youtube"><i
										class="icon-youtube"></i></a>
								<a href="#" class="social-icon" target="_blank" title="Pinterest"><i
										class="icon-pinterest"></i></a>
							</div><!-- End .soial-icons -->
						</div><!-- End .widget about-widget -->
					</div><!-- End .col-sm-6 col-lg-3 -->

					<div class="col-sm-6 col-lg-3">
						<div class="widget">
							<h4 class="widget-title">Useful Links</h4><!-- End .widget-title -->

							<ul class="widget-list">
								<li><a href="about">About Molla</a></li>
								<li><a href="#">How to shop on Molla</a></li>
								<li><a href="#">FAQ</a></li>
								<li><a href="contact">Contact us</a></li>
								<li><a href="login">Log in</a></li>
							</ul><!-- End .widget-list -->
						</div><!-- End .widget -->
					</div><!-- End .col-sm-6 col-lg-3 -->

					<div class="col-sm-6 col-lg-3">
						<div class="widget">
							<h4 class="widget-title">Customer Service</h4><!-- End .widget-title -->

							<ul class="widget-list">
								<li><a href="#">Payment Methods</a></li>
								<li><a href="#">Money-back guarantee!</a></li>
								<li><a href="#">Returns</a></li>
								<li><a href="#">Shipping</a></li>
								<li><a href="#">Terms and conditions</a></li>
								<li><a href="#">Privacy Policy</a></li>
							</ul><!-- End .widget-list -->
						</div><!-- End .widget -->
					</div><!-- End .col-sm-6 col-lg-3 -->

					<div class="col-sm-6 col-lg-3">
						<div class="widget">
							<h4 class="widget-title">My Account</h4><!-- End .widget-title -->

							<ul class="widget-list">
								<li><a href="#">Sign In</a></li>
								<li><a href="cart">View Cart</a></li>
								<li><a href="#">My Wishlist</a></li>
								<li><a href="#">Track My Order</a></li>
								<li><a href="#">Help</a></li>
							</ul>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="footer-bottom">
			<div class="container">
				<p class="footer-copyright">Copyright © 2019 Molla Store. All Rights Reserved.</p>
				<figure class="footer-payments">
					<img src="public/assets/images/payments.png" alt="Payment methods" width="272" height="20">
				</figure>
			</div>
		</div>
	</footer>
	</div>
	<button id="scroll-top" title="Back to Top"><i class="icon-arrow-up"></i></button>










<!-- modal for edit address -->
 <div class="modal fade" id="addAddressModals" tabindex="-1" role="dialog" aria-labelledby="addAddressModalLabel"
aria-hidden="true">
<div class="modal-dialog modal-dialog-centered" role="document">
	<div class="modal-content">
		<div class="modal-header">
			<h5 class="modal-title" id="addAddressModalLabel">Edit Address</h5>
			<button type="button" class="close" data-dismiss="modal" aria-label="Close">
				<span aria-hidden="true">&times;</span>
			</button>
		</div>
		<div class="modal-body">
			<form id="addAddressForms" >
				<div class="form-group">
					<label for="fullName">Full Name:</label>
					<input type="text" class="form-control" id="fullNames"  name="fullName" required>
					<div class="invalid-feedback">Please enter your full name.</div>
				</div>
				<div class="form-group">
					<label for="country">Country:</label>
					<input type="text" class="form-control" id="countrys" name="country" required>
					<div class="invalid-feedback">Please enter the country.</div>
				</div>
				<div class="form-group">
					<label for="housename">House Name:</label>
					<input type="text" class="form-control" id="housenames" name="housename" required>
					<div class="invalid-feedback">Please enter the house name.</div>
				</div>
				<div class="form-group">
					<label for="state">State:</label>
					<input type="text" class="form-control" id="states" name="state" required>
					<div class="invalid-feedback">Please enter the state.</div>
				</div>
				<div class="form-group">
					<label for="city">City:</label>
					<input type="text" class="form-control" id="citys" name="city" required>
					<div class="invalid-feedback">Please enter the city.</div>
				</div>
				<div class="form-group">
					<label for="pincode">Pincode (6 digits):</label>
					<input type="text" class="form-control" id="pincodes" name="pincode" pattern="\d{6}" required>
					<div class="invalid-feedback">Please enter a valid 6-digit pincode.</div>
				</div>
				<div class="form-group">
					<label for="phone">Phone (10 digits):</label>
					<input type="tel" class="form-control" id="phones" name="phone" pattern="\d{10}" required>
					<div class="invalid-feedback">Please enter a valid 10-digit phone number.</div>
				</div>
				<div class="form-group">
					<label for="email">Email:</label>
					<input type="email" class="form-control" id="emails" name="email" required>
					<div class="invalid-feedback">Please enter a valid email address.</div>
				</div>
				<input type="text" class="form-control" style="display: none;" id="addressId" name="addressId">
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
					<button type="submit"  class="btn btn-outline-warning" id="submitAddressBtns">Submit</button>
				</div>
			</form>
		</div>
	</div>
</div>
</div>


<!-- modal for adding address -->
<div class="modal fade" id="addAddressModal" tabindex="-1" role="dialog" aria-labelledby="addAddressModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="addAddressModalLabel">Add Address</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<form id="addAddressForm"  method="post" novalidate>
					<div class="form-group">
						<label for="fullName">Full Name:</label>
						<input type="text" class="form-control" id="fullName" name="fullName" required>
					</div>
					<div class="form-group">
						<label for="country">Country:</label>
						<input type="text" class="form-control" id="country" name="country" required>
					</div>
					<div class="form-group">
						<label for="housename">House Name:</label>
						<input type="text" class="form-control" id="housename" name="housename" required>
					</div>
					<div class="form-group">
						<label for="state">State:</label>
						<input type="text" class="form-control" id="state" name="state" required>
					</div>
					<div class="form-group">
						<label for="city">City:</label>
						<input type="text" class="form-control" id="city" name="city" required>
					</div>
					<div class="form-group">
						<label for="pincode">Pincode (6 digits):</label>
						<input type="text" class="form-control" id="pincode" name="pincode" pattern="\d{6}" required>
					</div>
					<div class="form-group">
						<label for="phone">Phone (10 digits):</label>
						<input type="tel" class="form-control" id="phone" name="phone" pattern="\d{10}" required>
					</div>
					<div class="form-group">
						<label for="email">Email:</label>
						<input type="email" class="form-control" id="email" name="email" required>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				<button type="button" class="btn btn-outline-warning" id="submitAddressBtn">Add Address</button>
			</div>
		</div>
	</div>
	</div>


<script>



//edit address
function showEditAddressModal(fullName, country, housename, state, city, pincode, phone, email, addressId) {
		   document.getElementById('fullNames').value = fullName;
		   document.getElementById('countrys').value = country;
		   document.getElementById('housenames').value = housename;
		   document.getElementById('states').value = state;
		   document.getElementById('citys').value = city;
		   document.getElementById('pincodes').value = pincode;
		   document.getElementById('phones').value = phone;
		   document.getElementById('emails').value = email;
		   document.getElementById('addressId').value = addressId;
	   
		   // Show the modal
		$('#addAddressModals').modal('show');
	   }
	   
	   $('#submitAddressBtns').on('click', function() {
		   const formData = $('#addAddressForms').serialize();
		   console.log(formData);
	   
		   $.ajax({
			   type: 'POST',
			   url: '/editaddresses',
			   data: formData,
			   success: function(response) {
				   if (response.success == true) {
					//    $('#addrassArea').load('/checkout #addrassArea');
					window.location.reload();
					   $('#addAddressModals').modal('hide');
					   $('.modal-backdrop').remove();
	   
				   }
			   },
			   error: function(error) {
				   console.error('Error:', error);
			   }
		   });
	   
		   return false;
	   });
	   


//add address
$(document).ready(function () {
    $('#submitAddressBtn').on('click', function () {
        if (validateForm()) {
            var formData = $('#addAddressForm').serialize();
            console.log(formData);

            $.ajax({
                type: 'POST',
                url: '/addaddresses',
                data: formData,
                success: function (response) {
                    console.log(response);
                    if (response.add == true) {
                        // $('#addrassArea').load('/account #addrassArea');
                        window.location.reload();
                        $('#addAddressModal').modal('hide');
                        $('.modal-backdrop').remove();
                        Swal.fire({
                            icon: 'success',
                            title: 'Address Added Successfully',
                            text: 'Your address has been added successfully.',
                        });
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Oops...',
                            text: 'There was a problem adding your address!',
                        });
                    }
                },
                error: function (error) {
                    console.error('Error:', error);
                }
            });
        }
    });

	function validateForm() {
    var fullName = $('#fullName').val().trim();
    var country = $('#country').val().trim();
    var housename = $('#housename').val().trim();
    var state = $('#state').val().trim();
    var city = $('#city').val().trim();
    var pincode = $('#pincode').val().trim();
    var phone = $('#phone').val().trim();
    var email = $('#email').val().trim();

    $('.error-message').remove();

    var isValid = true;

    if (fullName === '') {
        displayError('#fullName', 'Please enter your full name.');
        isValid = false;
    }

    if (country === '') {
        displayError('#country', 'Please enter the country.');
        isValid = false;
    }

    if (housename === '') {
        displayError('#housename', 'Please enter the house name.');
        isValid = false;
    }

    if (state === '') {
        displayError('#state', 'Please enter the state.');
        isValid = false;
    }

    if (city === '') {
        displayError('#city', 'Please enter the city.');
        isValid = false;
    }

	if (pincode === '') {
        displayError('#pincode', 'Please enter the pincode.');
        isValid = false;
     } else if (pincode.length !== 6 || !/^\d+$/.test(pincode)) {
       displayError('#pincode', 'Please enter a valid 6-digit pincode with only digits.');
       isValid = false;
}

if (phone === '') {
    displayError('#phone', 'Please enter the phone number.');
    isValid = false;
} else if (phone.length !== 10 || !/^\d+$/.test(phone)) {
    displayError('#phone', 'Please enter a valid 10-digit phone number with only digits.');
    isValid = false;
}


    if (email === '') {
        displayError('#email', 'Please enter the email.');
        isValid = false;
    } else if (!/\S+@\S+\.\S+/.test(email)) {
        displayError('#email', 'Please enter a valid email address.');
        isValid = false;
    }

    function displayError(elementId, message) {
        clearError(elementId);
        $(elementId).after('<div class="error-message text-danger">' + message + '</div>');
    }

    function clearError(elementId) {
        $(elementId).next('.error-message').remove();
    }

    return isValid;
}


  });

	   
  $(document).ready(function () {
    $("#placeOrderBtn").on("click", function (event) {
        var subtotalElement = document.getElementById("subtotal");
		var subtotal = parseFloat(subtotalElement.innerText.replace('₹', ''));
        var totalamountElement = document.getElementById('totalamount');
        var totalamount = parseFloat(totalamountElement.innerText.replace('₹', ''));

        var formData = $("#orderForm").serialize();

        formData += '&totalamount=' + encodeURIComponent(totalamount);
		formData += '&subtotal=' + encodeURIComponent(subtotal);


        event.preventDefault();

        console.log(formData, "is getting", totalamount,typeof(totalamount));
        $.ajax({
            type: "POST",
            url: "/placeorder",
            data: formData,
            success: function (response) {
                console.log(response);
                if (response.placed == true) {
                    const id = response.orderId;
                    window.location.href = `/success?id=${id}`;
                } else if (response.wallet == false) {
                    swal.fire("Oops, it looks like your wallet balance is too low to place this order !!", "", "error")
                } else {
                    razorpayPayment(response.order);
                }
            },
            error: function (error) {
                console.error('Error:', error);
                alert("An error occurred while processing the order.");
            }
        });
    });
});


function razorpayPayment(order) {
    console.log(order,"tihiu");
    var options = {
        "key": "rzp_test_6nfEH21z7G2Wtu",
        "amount": order.amount,
        "currency": "INR",
        "name": "Furni.Ltd",
        "description": "Test Transaction",
        "image": "",
        "order_id": order.id,
        handler: function (response) {
            verifyPayment(response, order);
			},
			"prefill": {
				"name": "Furni Ltd",
				"email": "furniworld@gmail.com",
				"contact": "9999999999"
			},
			"notes": {
				"address": "India"
			},
			"theme": {
				"color": "#cc9967"
        }
    };

    var rzp1 = new Razorpay(options);
    rzp1.open();
}

function verifyPayment(payment, order) {

    $.ajax({
        url: "/verifypayment",
        method: "post",
        data: {
            payment: payment,
            order: order,
        },
        success: (response) => {
            if (response.placed == true) {
                const orderId = response.orderId
                window.location.href = `/success?id=${orderId}`;
            } else {
                swal.fire({
                    positon: "center",
                    icon: "error",
                    title: "Payment failed",
                    showConfirmButton: false,
                    timer: 1500,
                });
            }
        },
    });
}


function applyCoupon() {
    const couponCodeInput = document.getElementById("couponinput"); 
    const couponCode = couponCodeInput.value;
    $.ajax({
        type: "POST",
        url: "/checkcoupon", 
        data: { coupon: couponCode },
        success: function(response) {
            if(response.coupon == false) {
                swal.fire("No Coupon Available", "", "error");
            } else if(response.coupon == 'notAct') {
                swal.fire("This Coupon is No Longer Available", "", "error");
            } else if(response.coupon == 'used') {
                swal.fire("This Coupon is Already Used. Try Another One", "", "error");
            } else if(response.coupon == 'amountIssue') {
                swal.fire("Purchase More to Use This Coupon", "", "error");
            } else if(response.coupon) {
                swal.fire("Success", "Coupon Added!", "success");
                $('#reloadArea').load('/checkout #reloadArea'); 
                $('#reloadArea2').load('/checkout #reloadArea2');
            } else {
                swal.fire("Something Went Wrong", "", "error");
            }
        }
    });
}


function removecoupon(){
        $.ajax({
            method: 'POST',
            url: '/removecoupon', 
            data: JSON.stringify(),
            contentType: 'application/json',
            success: function (response) {
                if(response.remove===true){
					swal.fire("Success", "Coupon Removed!", "success");
                    $('#reloadArea').load('/checkout #reloadArea');
                    $('#reloadArea2').load('/checkout #reloadArea2');
                }else{
                 
                }
            },
            error: function (error) {

                console.error(error);
            }
        });
    }



</script>



	<!-- Plugins JS File -->
	<!-- <script src="/public/assets/js/checkout.js"></script> -->
	<script src="/public/assets/js/loader.js"></script>
	<script src="public/assets/js/jquery.min.js"></script>
	<script src="public/assets/js/bootstrap.bundle.min.js"></script>
	<script src="public/assets/js/jquery.hoverIntent.min.js"></script>
	<script src="public/assets/js/jquery.waypoints.min.js"></script>
	<script src="public/assets/js/superfish.min.js"></script>
	<script src="public/assets/js/owl.carousel.min.js"></script>
	<!-- Main JS File -->
	<script src="public/assets/js/main.js"></script>

</body>



</html>